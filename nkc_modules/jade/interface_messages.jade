extends bootstrap_base.jade

block title
  title 短消息
  meta#replytarget(value='#{data.replytarget}')

block content
  -function changeTime(value)
    -var add_0 = function(value)
      -if(value <= 9)
        -return '0' + value;
      -else
        -return value;
    -var time = new Date(parseInt(value));
    -var out = time.getFullYear() + '-' + add_0(time.getMonth()+1) + '-' + add_0(time.getDate()) + ' ' + add_0(time.getHours()) + ':' + add_0(time.getMinutes()) + ':' + add_0(time.getSeconds());
    -return out;
  //-拿到data里面的数据
  -var nowAt = data.tab;
  -var page = (data.paging.page) ? data.paging.page + 1 : 1;
  -var pageCount = data.paging.pagecount;
  -var obj = {replies: '回复', at: '@', messages: '短消息', system: '系统'};
  -var docs = data.docs;

  .container
    .row
      .panel.panel-default(style='overflow:hidden;')
        .col-xs-12.col-md-12
          ul.nav.nav-tabs
            li(class='#{nowAt === "replies"? "active": ""}')
              a(href='/sms?&tab=replies') 回复提醒
            li(class='#{nowAt === "at"? "active": ""}')
              a(href='/sms?&tab=at') @我的
            li(class='#{nowAt === "messages"? "active": ""}')
              a(href='/sms?&tab=messages') 短消息
            li(class='#{nowAt === "system"? "active": ""}')
              a(href='/sms?&tab=system') 系统通知
        .col-xs-12.col-md-12(style="margin:0.4em 0 0 0")
          nav(aria-label='navigation')
            ul.pagination(style="margin:0")
              //- 当前页数若大于4则显示首页按钮
              //- 若总的分页数小于7则不需要显示首页和尾页按钮
              -if(page > 4 && pageCount > 7)
                li
                  a(href='/sms?&page=1&tab=#{nowAt}') 首
              //- n为总共需要显示的分页按钮个数
              //- i为循环中当前生成的页数
              -var n = 7;
              -var min = pageCount - 3;
              -if(page > min)
                -min = pageCount - 6;
              -else
                -min = page - 3;
              -for(var i = min ; 1 ; i++)
                -if(n == 0)
                  -break;
                -if(i <= 0)
                  -continue;
                -if(i > pageCount)
                  -break;
                //- 生成当前所在也输得按钮时，有蓝色背景，不可点击
                -if(i == page)
                  li.active
                    a(href='javscript:void(0)') #{i}
                -else
                  li
                    a(href='/sms?&page=#{i}&tab=#{nowAt}') #{i}
                -n--;
              //- 当前页数若小于 最大分页数-3 则显示尾页按钮
              -if(page < pageCount - 3 && pageCount > 7)
                li
                  a(href='/sms?&page=#{pageCount}&tab=#{nowAt}') 末
        -if(nowAt === 'replies')
          .col-xs-12.col-md-12
            -for(var i = 0 ; i < docs.length; i++)
                hr(style='margin:0.5em 0;')
                .media
                  span #{changeTime(docs[i].fromPost.toc)}
                  .media-left.media-top
                    a(href='###')
                      img.media-object.img-rounded(src='http://192.168.11.24:1086/avatar/71807',alt='name',style='height:4em;width:4em;')
                  .media-body
                    h4.media-heading
                      a(href='###') 离歌笑
                      span(style="font-size:0.8em;") 在帖子
                      a(href='###') 、䲠，这两个字有什么不同？
                      span(style="font-size:0.8em;") 下回复你：
                      p(style="font-size:0.8em;") 这两个字在Windows操作系统下都是chun鱼的chun，但是前者在其它系统下却可能变为乱码。这是由于前者是GBK增补字符集PUA编码，而后者是Unicode标准非PUA编码。受影响的有106个字符。而后者是Unicode标准非PUA编码。受影响的有106个字符。而后者是Unicode标准非PUA编码。受影响的有106个字符。而后者是Unicode标准非PUA编码。受影响的有106个字符。而后者是Unicode标准非PUA编码。受影响的有106个字符。而后者是Unicode标准非PUA编码。受影响的有106个字符。而后者是Unicode标准非PUA编码。受影响的有106个字符。而后者是Unicode标准非PUA编码。受影响的有106个字符。由于不是所有字体都支持这106个PUA字符，导致了UTF-8在这106个字符上实际上并不跨平台。考虑到大多数操作系统都支持Unicode，如果要让文本跨平台使用，最好转换为非PUA编码。
    p #{JSON.stringify(data)}













 //-          -var obj = {replies: '回复', at: '@', messages: '短消息', system: '系统'}
 //-            h4 #{obj[nowAt]}
 //-            for doc in data.docs = data.docs;

 //- docs.length           if(nowAt === 'replies')
 //-                div #{doc.fromPost.c}
 //-              if(nowAt === 'at')
 //-                div #{doc.user}
 //-              if(nowAt === 'messages')
 //-                if(!data.conversation)
 //-                  div
 //-                    a(href='/sms?&tab=messages&conversation=#{doc.conversation._key}') #{doc.conversation.username + '说' + doc.group[0].c}
 //-                else
 //-                  div #{doc.s} #{doc.c}
 //-              if(nowAt === 'system')
 //-                div #{doc.c}

          //nav
          //  include interface_navigation_paging.jade
                
        
  include debug_output.jade

block scripts
  script(src='/interface_common.js')
  script(src='/interface_messages.js')
